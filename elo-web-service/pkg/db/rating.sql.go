// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: rating.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const ratingHistory = `-- name: RatingHistory :many

SELECT m.date, ms.new_elo as rating
FROM match_scores ms
JOIN matches m ON m.id = ms.match_id
WHERE ms.player_id = $1
ORDER BY m.date
`

type RatingHistoryRow struct {
	Date   pgtype.Timestamptz `json:"date"`
	Rating pgtype.Float8      `json:"rating"`
}

// NOTE: UpsertRating is deprecated - Elo ratings are now stored in match_scores table
// Kept for backwards compatibility but not actively used
// -- name: UpsertRating :exec
// INSERT INTO player_ratings (date, player_id, rating)
// VALUES ($1, $2, $3)
// ON CONFLICT (date, player_id)
// DO UPDATE SET rating = EXCLUDED.rating;
func (q *Queries) RatingHistory(ctx context.Context, playerID int32) ([]RatingHistoryRow, error) {
	rows, err := q.db.Query(ctx, ratingHistory, playerID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []RatingHistoryRow{}
	for rows.Next() {
		var i RatingHistoryRow
		if err := rows.Scan(&i.Date, &i.Rating); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
